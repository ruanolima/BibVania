<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOGIN - BIBVANIA ONLINE</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
</head>
<body style="display: flex; align-items: center; justify-content: center; padding: 1.5rem;">
    <div class="accessibility-bar">
        <button class="control-btn" onclick="window.open('https://github.com/ruanolima/BibVania', '_blank')" style="flex-grow:1; text-align:left;">üìÅ Reposit√≥rio</button>
        <button class="control-btn" onclick="changeFontSize(1)">A+</button>
        <button class="control-btn" onclick="changeFontSize(-1)">A-</button>
        <button class="control-btn" onclick="toggleDarkMode()" id="darkModeBtn">üåô</button>
    </div>

    <div class="login-box">
        <div style="margin-bottom: 2rem; display:flex; flex-direction:column; align-items:center; gap:0.4rem; text-align:center;">
            <img src="logo.png" alt="Logo BibVania" style="height:72px; width:auto;">
            <h1 style="color: var(--primary); font-size: 1.25rem; line-height:1.2;">BIBVANIA ONLINE</h1>
            <div id="nomeEscolaLogin" class="school-name"><span>BIBLIOTECA ESCOLAR DA EMTI</span><span>PROFESSORA MARIA V√ÇNIA FARIAS LINHARES</span></div>
        </div>

        <form id="loginForm" style="text-align: left;">
            <div class="form-group">
                <label>E-MAIL</label>
                <input type="email" id="email" placeholder="seu@email.com" required autocapitalize="none" autocorrect="off" autocomplete="username">
            </div>
            <div class="form-group">
                <label>SENHA</label>
                <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required autocomplete="current-password">
            </div>
            <button type="submit" class="btn-block btn-primary" style="margin-top: 1rem;">ENTRAR NO PAINEL</button>
            <div id="loginError" style="color: var(--danger); font-size: 0.75rem; font-weight: bold; margin-top: 1rem; text-align: center;"></div>
        </form>

        <div style="margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid var(--border);">
            <button onclick="window.location.href='index.html'" class="btn-block btn-outline" style="background: none; border: 1px solid var(--border); color: var(--text-light);">
                ‚Üê VOLTAR PARA CONSULTA
            </button>
        </div>
    </div>

    <script src="database.js" type="module"></script>
    <script type="module">
        let fontSize = parseInt(localStorage.getItem('fontSize')) || 16;

        window.changeFontSize = (delta) => {
            fontSize = Math.min(Math.max(fontSize + delta, 12), 24);
            document.documentElement.style.setProperty('--font-size', fontSize + 'px');
            localStorage.setItem('fontSize', fontSize);
        };

        window.toggleDarkMode = () => {
            const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', theme);
            document.getElementById('darkModeBtn').innerText = theme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            localStorage.setItem('theme', theme);
        };

        function aplicarPreferencias() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            const btn = document.getElementById('darkModeBtn');
            if (btn) btn.innerText = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
            document.documentElement.style.setProperty('--font-size', fontSize + 'px');
            
            const el = document.getElementById('nomeEscolaLogin');
            if (el) el.innerHTML = '<span>BIBLIOTECA ESCOLAR DA EMTI</span><span>PROFESSORA MARIA V√ÇNIA FARIAS LINHARES</span>';
        }

        async function aguardarDB() {
            while (!window.DB) await new Promise(r => setTimeout(r, 100));
        }

        (async () => {
            await aguardarDB();
            aplicarPreferencias();
            await window.DB.redirectIfLoggedIn();
        })();

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const errorDiv = document.getElementById('loginError');
            
            errorDiv.innerText = "AUTENTICANDO...";
            
            try {
                await window.DB.signIn(email, password);
                window.location.href = 'admin.html';
            } catch (error) {
                errorDiv.innerText = "‚ùå E-MAIL OU SENHA INCORRETOS.";
            }
        });
    </script>
    <div vw class="enabled"><div vw-access-button class="active"></div><div vw-plugin-wrapper><div class="vw-plugin-top-wrapper"></div></div></div>
    <script src="https://vlibras.gov.br/app/vlibras-plugin.js"></script>
    <script>new window.VLibras.Widget('https://vlibras.gov.br/app');</script>
</body>
</html>
